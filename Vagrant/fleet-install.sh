#!/bin/sh
if [ "$1" = "uninstall" ]
then
  /opt/apica/bin/agent-manager-fluent-bit --uninstall=fluent-bit --config_dir="/etc/agent-manager" --system_dir="/usr/lib/systemd/system"
else
  mkdir -p /opt/apica/bin
  wget --no-check-certificate -O /opt/apica/bin/agent-manager-fluent-bit https://useaasocat01p.apica.io/v1/fleet/downloads/agent-manager/linux/agent-manager
  chmod +x /opt/apica/bin/agent-manager-fluent-bit
  /opt/apica/bin/agent-manager-fluent-bit --install=fluent-bit --configuration="Y29uZmlnX2ZpbGU6IG51bGwKcGFja2FnZV9kaXI6IC9vcHQvYXBpY2EvdmFyL2FnZW50LW1hbmFnZXIvcGFja2FnZXMKbmFtZTogbnVsbApuYW1lc3BhY2U6IG51bGwKYXV0b191cGRhdGU6IHRydWUKbG9nOgogICAgbGV2ZWw6IGluZm8KICAgIG91dDogc3Rkb3V0CiAgICBmb3JtYXQ6IHRleHQKICAgIHNpemU6IDE2MzgzCiAgICBlY2hvOiB0cnVlCnNlcnZlcjoKICAgIGVuZHBvaW50OiBodHRwczovL3VzZWFhc29jYXQwMXAuYXBpY2EuaW8vdjEvZmxlZXQvb3BhbXAKICAgIHRpbWVvdXQ6IDMwcwogICAgaW5zZWN1cmU6IG51bGwKYWdlbnQ6CiAgICBhZ2VudF90eXBlOiBmbHVlbnQtYml0CiAgICBwbGF0Zm9ybTogbGludXgKICAgIGV4ZWN1dGFibGU6IC9vcHQvZmx1ZW50LWJpdC9iaW4vZmx1ZW50LWJpdAogICAgYXJnczoKICAgICAgICAtIC0tY29uZmlnPS9ldGMvZmx1ZW50LWJpdC9mbHVlbnQtYml0LnlhbWwKICAgIHVzZXI6IG51bGwKICAgIGdyb3VwOiBudWxsCiAgICBpbnN0YW5jZV9pZF9maWxlOiAvZXRjL2FnZW50LW1hbmFnZXIvYWdlbnQtbWFuYWdlci1mbHVlbnQtYml0LmlkCiAgICBhdXRoX3Rva2VuX2ZpbGU6IC9ldGMvYWdlbnQtbWFuYWdlci9hZ2VudC1tYW5hZ2VyLWZsdWVudC1iaXQudG9rCiAgICB2ZXJzaW9uX2NvbW1hbmQ6IC0tdmVyc2lvbgogICAgcmVzdGFydF9jb21tYW5kOiBudWxsCiAgICBjb25maWdfZmlsZXM6IHt9CiAgICBkYXRhOiB7fQogICAgc2VjcmV0OgogICAgICAgIGFwaWNhbG9nczoKICAgICAgICAgICAgZW5kcG9pbnQ6IGh0dHBzOi8vdXNlYWFzb2NhdDAxcC5hcGljYS5pby92MS9qc29uX2JhdGNoCiAgICAgICAgICAgIHRva2VuOiBleUpoYkdjaU9pSlNVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKaFkyTmxjM01pT2x0ZExDSmhkV1FpT2lKc2IyZHBjUzFqYkdsbGJuUnpJaXdpYW5ScElqb2lNMlJrTldJd01tRXRPRFF3TlMwME5UUXhMVGd3WkRRdFl6RmlNRGhtWkRZMU56WmxJaXdpYVdGMElqb3hOek0yT1RjMk16ZzNMQ0pwYzNNaU9pSnNiMmRwY1MxamIyWm1aV1V0YzJWeWRtVnlJaXdpYm1KbUlqb3hOek0yT1RjMk16ZzNMQ0p6ZFdJaU9pSmtaWFp2Y0hOQVlYQnBZMkV1YVc4aUxDSlZhV1FpT2pFc0luSnZiR1VpT2lKaFpHMXBiaUo5LnBaQVd5TE1OenNDZEk1MWtOd2JOUTluWGUwSnJoN2oweVBvUHppVmZiZEF1elBxckpOWVhhS0VzNVZVa0dOMkZoZXJRVzNvYzZXeUpnMWF0V1hlZTJpR2oyeFFiVG5PdllndFJiM29pSXdfcDdPYmJSclNLT0tyN2k2OVFhMFFyV0ZMWi13WGNub2hvTHlCMF9wZjlHTUxERG82WXpVV0ZNdEV5aGJvanQtUUpfdWFYbDhsOVdlZ0VWSnRaQ1B0dGFJejRSSWhxelJvaEpkay1ILUpkM2NFeC1BNHRxV3VGM2JqTW1hWVdFSmxLRU1HRVBWUTVBT0lJTGg1dmZ2V29RdXFYTlJsQkZpU3JhcHNHSFE2NUFBcGxjc3d0dnpaTUxQVWpOTW9WeDJ2bEdLdEoxdV8yRWpqZGRiTk44T3ZqUU1TNGg0NU1GQ1hGaXJQYzliZFVkZwogICAgICAgIGFwaWNhbWV0cmljczoKICAgICAgICAgICAgZW5kcG9pbnQ6IGh0dHBzOi8vdXNlYWFzb2NhdDAxcC5hcGljYS5pby92MS9yZWNlaXZlL3Byb21ldGhldXMKICAgICAgICBhcGljYXRyYWNlczoKICAgICAgICAgICAgZW5kcG9pbnQ6IHVzZWFhc29jYXQwMXAuYXBpY2EuaW8vdjEvdHJhY2VzCiAgICAgICAgb3RlbGxvZ3M6CiAgICAgICAgICAgIGVuZHBvaW50OiBodHRwczovL3VzZWFhc29jYXQwMXAuYXBpY2EuaW8vdjEvbG9ncwogICAgICAgICAgICB0b2tlbjogZXlKaGJHY2lPaUpTVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SmhZMk5sYzNNaU9sdGRMQ0poZFdRaU9pSnNiMmRwY1MxamJHbGxiblJ6SWl3aWFuUnBJam9pTTJSa05XSXdNbUV0T0RRd05TMDBOVFF4TFRnd1pEUXRZekZpTURobVpEWTFOelpsSWl3aWFXRjBJam94TnpNMk9UYzJNemczTENKcGMzTWlPaUpzYjJkcGNTMWpiMlptWldVdGMyVnlkbVZ5SWl3aWJtSm1Jam94TnpNMk9UYzJNemczTENKemRXSWlPaUprWlhadmNITkFZWEJwWTJFdWFXOGlMQ0pWYVdRaU9qRXNJbkp2YkdVaU9pSmhaRzFwYmlKOS5wWkFXeUxNTnpzQ2RJNTFrTndiTlE5blhlMEpyaDdqMHlQb1B6aVZmYmRBdXpQcXJKTllYYUtFczVWVWtHTjJGaGVyUVczb2M2V3lKZzFhdFdYZWUyaUdqMnhRYlRuT3ZZZ3RSYjNvaUl3X3A3T2JiUnJTS09LcjdpNjlRYTBRcldGTFotd1hjbm9ob0x5QjBfcGY5R01MRERvNll6VVdGTXRFeWhib2p0LVFKX3VhWGw4bDlXZWdFVkp0WkNQdHRhSXo0UklocXpSb2hKZGstSC1KZDNjRXgtQTR0cVd1RjNiak1tYVlXRUpsS0VNR0VQVlE1QU9JSUxoNXZmdldvUXVxWE5SbEJGaVNyYXBzR0hRNjVBQXBsY3N3dHZ6Wk1MUFVqTk1vVngydmxHS3RKMXVfMkVqamRkYk5OOE92alFNUzRoNDVNRkNYRmlyUGM5YmRVZGcKICAgICAgICBvdGVsbWV0cmljczoKICAgICAgICAgICAgZW5kcG9pbnQ6IGh0dHBzOi8vdXNlYWFzb2NhdDAxcC5hcGljYS5pby92MS9tZXRyaWNzCiAgICAgICAgb3RlbHRyYWNlczoKICAgICAgICAgICAgZW5kcG9pbnQ6IHVzZWFhc29jYXQwMXAuYXBpY2EuaW8vdjEvdHJhY2VzCiAgICB0YWdzOiBudWxsCiAgICBkZWZhdWx0X3BhY2thZ2VfYXNzaWdubWVudHM6CiAgICAgICAgLSBmbHVlbnQtYml0L2xpbnV4L2ZsdWVudC1iaXRfMy4yLjNfbGludXhfYW1kNjQuemlwCiAgICBkZWZhdWx0X2NvbmZpZ19hc3NpZ25tZW50czoKICAgICAgICAtIGZsdWVudC1iaXQvbGludXgvZGVmYXVsdC9ldGMvZmx1ZW50LWJpdC9mbHVlbnQtYml0LnlhbWwK" --register="eyJhbGciOiJIUzUxMiIsImtpZCI6IjQ5MWZhYzRkLWU4MmEtNGRkNi05NTE2LWVhMWRiYmJkOWMxMyIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsiZmxlZXQiXSwiZXhwIjoxNzY4NTEyMzg3LCJpYXQiOjE3MzY5NzYzODcsImlzcyI6ImZsZWV0IiwibmJmIjoxNzM2OTc2Mzg3LCJyb2xlIjoicmVmcmVzaCIsInN1YiI6IjAiLCJ0b2tlbl9pZCI6ImMyM2M3OWQ4LTM0NTctNDZlNS1iMTczLWM0NTg2MTU0ODAxOSJ9.S7Letf85xdB5w0QhF7UR8MTjlc67heKbolEuGhNAz7BHw5d05_VPl6E-70Nv0kfXLtwXz9uj0X27IocciKI1ZQ" --config_dir="/etc/agent-manager" --system_dir="/usr/lib/systemd/system"
fi
